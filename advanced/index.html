
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A next-generation HTTP client for Python.">
      
      
      
        <link rel="canonical" href="https://www.python-httpx.org/advanced/">
      
      
        <link rel="prev" href="../quickstart/">
      
      
        <link rel="next" href="../async/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.5">
    
    
      
        <title>Advanced Usage - HTTPX</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="HTTPX" class="md-header__button md-logo" aria-label="HTTPX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HTTPX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced Usage
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/encode/httpx/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    encode/httpx
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HTTPX" class="md-nav__button md-logo" aria-label="HTTPX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    HTTPX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/encode/httpx/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    encode/httpx
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        QuickStart
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Advanced Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Advanced Usage
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#client-instances" class="md-nav__link">
    Client Instances
  </a>
  
    <nav class="md-nav" aria-label="Client Instances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-use-a-client" class="md-nav__link">
    Why use a Client?
  </a>
  
    <nav class="md-nav" aria-label="Why use a Client?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-efficient-usage-of-network-resources" class="md-nav__link">
    More efficient usage of network resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-features" class="md-nav__link">
    Extra features
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-requests" class="md-nav__link">
    Making requests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-configuration-across-requests" class="md-nav__link">
    Sharing configuration across requests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging-of-configuration" class="md-nav__link">
    Merging of configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-client-only-configuration-options" class="md-nav__link">
    Other Client-only configuration options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#character-set-encodings-and-auto-detection" class="md-nav__link">
    Character set encodings and auto-detection
  </a>
  
    <nav class="md-nav" aria-label="Character set encodings and auto-detection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-default-encoding" class="md-nav__link">
    Using the default encoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-an-explicit-encoding" class="md-nav__link">
    Using an explicit encoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-character-set-auto-detection" class="md-nav__link">
    Using character set auto-detection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-into-python-web-apps" class="md-nav__link">
    Calling into Python Web Apps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-instances" class="md-nav__link">
    Request instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-hooks" class="md-nav__link">
    Event Hooks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-download-progress" class="md-nav__link">
    Monitoring download progress
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#netrc-support" class="md-nav__link">
    .netrc Support
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-proxying" class="md-nav__link">
    HTTP Proxying
  </a>
  
    <nav class="md-nav" aria-label="HTTP Proxying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing" class="md-nav__link">
    Routing
  </a>
  
    <nav class="md-nav" aria-label="Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wildcard-routing" class="md-nav__link">
    Wildcard routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-routing" class="md-nav__link">
    Scheme routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-routing" class="md-nav__link">
    Domain routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-routing" class="md-nav__link">
    Port routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-proxy-support" class="md-nav__link">
    No-proxy support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-configuration-example" class="md-nav__link">
    Complex configuration example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy-mechanisms" class="md-nav__link">
    Proxy mechanisms
  </a>
  
    <nav class="md-nav" aria-label="Proxy mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forward-vs-tunnel" class="md-nav__link">
    FORWARD vs TUNNEL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-proxies" class="md-nav__link">
    Troubleshooting proxies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#socks" class="md-nav__link">
    SOCKS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeout-configuration" class="md-nav__link">
    Timeout Configuration
  </a>
  
    <nav class="md-nav" aria-label="Timeout Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-and-disabling-timeouts" class="md-nav__link">
    Setting and disabling timeouts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-a-default-timeout-on-a-client" class="md-nav__link">
    Setting a default timeout on a client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-tuning-the-configuration" class="md-nav__link">
    Fine tuning the configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pool-limit-configuration" class="md-nav__link">
    Pool limit configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multipart-file-encoding" class="md-nav__link">
    Multipart file encoding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-authentication" class="md-nav__link">
    Customizing authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-certificates" class="md-nav__link">
    SSL certificates
  </a>
  
    <nav class="md-nav" aria-label="SSL certificates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changing-the-verification-defaults" class="md-nav__link">
    Changing the verification defaults
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-configuration-on-client-instances" class="md-nav__link">
    SSL configuration on client instances
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-side-certificates" class="md-nav__link">
    Client Side Certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-https-requests-to-a-local-server" class="md-nav__link">
    Making HTTPS requests to a local server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-transports" class="md-nav__link">
    Custom Transports
  </a>
  
    <nav class="md-nav" aria-label="Custom Transports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage_1" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urllib3-transport" class="md-nav__link">
    urllib3 transport
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-custom-transports" class="md-nav__link">
    Writing custom transports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mock-transports" class="md-nav__link">
    Mock transports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounting-transports" class="md-nav__link">
    Mounting transports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../async/" class="md-nav__link">
        Async Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../http2/" class="md-nav__link">
        HTTP/2 Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compatibility/" class="md-nav__link">
        Requests Compatibility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        Developer Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../environment_variables/" class="md-nav__link">
        Environment Variables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Community
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Community
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../third_party_packages/" class="md-nav__link">
        Third Party Packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../code_of_conduct/" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#client-instances" class="md-nav__link">
    Client Instances
  </a>
  
    <nav class="md-nav" aria-label="Client Instances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-use-a-client" class="md-nav__link">
    Why use a Client?
  </a>
  
    <nav class="md-nav" aria-label="Why use a Client?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-efficient-usage-of-network-resources" class="md-nav__link">
    More efficient usage of network resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-features" class="md-nav__link">
    Extra features
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-requests" class="md-nav__link">
    Making requests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharing-configuration-across-requests" class="md-nav__link">
    Sharing configuration across requests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging-of-configuration" class="md-nav__link">
    Merging of configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-client-only-configuration-options" class="md-nav__link">
    Other Client-only configuration options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#character-set-encodings-and-auto-detection" class="md-nav__link">
    Character set encodings and auto-detection
  </a>
  
    <nav class="md-nav" aria-label="Character set encodings and auto-detection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-default-encoding" class="md-nav__link">
    Using the default encoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-an-explicit-encoding" class="md-nav__link">
    Using an explicit encoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-character-set-auto-detection" class="md-nav__link">
    Using character set auto-detection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-into-python-web-apps" class="md-nav__link">
    Calling into Python Web Apps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-instances" class="md-nav__link">
    Request instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-hooks" class="md-nav__link">
    Event Hooks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-download-progress" class="md-nav__link">
    Monitoring download progress
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#netrc-support" class="md-nav__link">
    .netrc Support
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-proxying" class="md-nav__link">
    HTTP Proxying
  </a>
  
    <nav class="md-nav" aria-label="HTTP Proxying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing" class="md-nav__link">
    Routing
  </a>
  
    <nav class="md-nav" aria-label="Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wildcard-routing" class="md-nav__link">
    Wildcard routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-routing" class="md-nav__link">
    Scheme routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-routing" class="md-nav__link">
    Domain routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-routing" class="md-nav__link">
    Port routing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-proxy-support" class="md-nav__link">
    No-proxy support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-configuration-example" class="md-nav__link">
    Complex configuration example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy-mechanisms" class="md-nav__link">
    Proxy mechanisms
  </a>
  
    <nav class="md-nav" aria-label="Proxy mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forward-vs-tunnel" class="md-nav__link">
    FORWARD vs TUNNEL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-proxies" class="md-nav__link">
    Troubleshooting proxies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#socks" class="md-nav__link">
    SOCKS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeout-configuration" class="md-nav__link">
    Timeout Configuration
  </a>
  
    <nav class="md-nav" aria-label="Timeout Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-and-disabling-timeouts" class="md-nav__link">
    Setting and disabling timeouts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-a-default-timeout-on-a-client" class="md-nav__link">
    Setting a default timeout on a client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fine-tuning-the-configuration" class="md-nav__link">
    Fine tuning the configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pool-limit-configuration" class="md-nav__link">
    Pool limit configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multipart-file-encoding" class="md-nav__link">
    Multipart file encoding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-authentication" class="md-nav__link">
    Customizing authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-certificates" class="md-nav__link">
    SSL certificates
  </a>
  
    <nav class="md-nav" aria-label="SSL certificates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changing-the-verification-defaults" class="md-nav__link">
    Changing the verification defaults
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-configuration-on-client-instances" class="md-nav__link">
    SSL configuration on client instances
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-side-certificates" class="md-nav__link">
    Client Side Certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-https-requests-to-a-local-server" class="md-nav__link">
    Making HTTPS requests to a local server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-transports" class="md-nav__link">
    Custom Transports
  </a>
  
    <nav class="md-nav" aria-label="Custom Transports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage_1" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urllib3-transport" class="md-nav__link">
    urllib3 transport
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-custom-transports" class="md-nav__link">
    Writing custom transports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mock-transports" class="md-nav__link">
    Mock transports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounting-transports" class="md-nav__link">
    Mounting transports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="advanced-usage">Advanced Usage</h1>
<h2 id="client-instances">Client Instances</h2>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you are coming from Requests, <code>httpx.Client()</code> is what you can use instead of <code>requests.Session()</code>.</p>
</div>
<h3 id="why-use-a-client">Why use a Client?</h3>
<div class="admonition note">
<p class="admonition-title">TL;DR</p>
<p>If you do anything more than experimentation, one-off scripts, or prototypes, then you should use a <code>Client</code> instance.</p>
</div>
<h4 id="more-efficient-usage-of-network-resources">More efficient usage of network resources</h4>
<p>When you make requests using the top-level API as documented in the <a href="../quickstart/">Quickstart</a> guide, HTTPX has to establish a new connection <em>for every single request</em> (connections are not reused). As the number of requests to a host increases, this quickly becomes inefficient.</p>
<p>On the other hand, a <code>Client</code> instance uses <a href="https://en.wikipedia.org/wiki/HTTP_persistent_connection">HTTP connection pooling</a>. This means that when you make several requests to the same host, the <code>Client</code> will reuse the underlying TCP connection, instead of recreating one for every single request.</p>
<p>This can bring <strong>significant performance improvements</strong> compared to using the top-level API, including:</p>
<ul>
<li>Reduced latency across requests (no handshaking).</li>
<li>Reduced CPU usage and round-trips.</li>
<li>Reduced network congestion.</li>
</ul>
<h4 id="extra-features">Extra features</h4>
<p><code>Client</code> instances also support features that aren't available at the top-level API, such as:</p>
<ul>
<li>Cookie persistence across requests.</li>
<li>Applying configuration across all outgoing requests.</li>
<li>Sending requests through HTTP proxies.</li>
<li>Using <a href="../http2/">HTTP/2</a>.</li>
</ul>
<p>The other sections on this page go into further detail about what you can do with a <code>Client</code> instance.</p>
<h3 id="usage">Usage</h3>
<p>The recommended way to use a <code>Client</code> is as a context manager. This will ensure that connections are properly cleaned up when leaving the <code>with</code> block:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<p>Alternatively, you can explicitly close the connection pool without block-usage using <code>.close()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="making-requests">Making requests</h3>
<p>Once you have a <code>Client</code>, you can send requests using <code>.get()</code>, <code>.post()</code>, etc. For example:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span>
<span class="go">&lt;Response [200 OK]&gt;</span>
</code></pre></div>

<p>These methods accept the same arguments as <code>httpx.get()</code>, <code>httpx.post()</code>, etc. This means that all features documented in the <a href="../quickstart/">Quickstart</a> guide are also available at the client level.</p>
<p>For example, to send a request with custom headers:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Custom&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">}</span>
<span class="gp">... </span>    <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Custom&#39;</span><span class="p">]</span>
<span class="go">&#39;value&#39;</span>
</code></pre></div>

<h3 id="sharing-configuration-across-requests">Sharing configuration across requests</h3>
<p>Clients allow you to apply configuration to all outgoing requests by passing parameters to the <code>Client</code> constructor.</p>
<p>For example, to apply a set of custom headers <em>on every request</em>:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/headers&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user-agent&#39;</span><span class="p">:</span> <span class="s1">&#39;my-app/0.0.1&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">]</span>
<span class="go">&#39;my-app/0.0.1&#39;</span>
</code></pre></div>

<h3 id="merging-of-configuration">Merging of configuration</h3>
<p>When a configuration option is provided at both the client-level and request-level, one of two things can happen:</p>
<ul>
<li>For headers, query parameters and cookies, the values are combined together. For example:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Auth&#39;</span><span class="p">:</span> <span class="s1">&#39;from-client&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="s1">&#39;client1&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Custom&#39;</span><span class="p">:</span> <span class="s1">&#39;from-request&#39;</span><span class="p">}</span>
<span class="gp">... </span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="s1">&#39;request1&#39;</span><span class="p">}</span>
<span class="gp">... </span>    <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
<span class="go">URL(&#39;https://example.com?client_id=client1&amp;request_id=request1&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Auth&#39;</span><span class="p">]</span>
<span class="go">&#39;from-client&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Custom&#39;</span><span class="p">]</span>
<span class="go">&#39;from-request&#39;</span>
</code></pre></div>

<ul>
<li>For all other parameters, the request-level value takes priority. For example:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tom&#39;</span><span class="p">,</span> <span class="s1">&#39;mot123&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;alice&#39;</span><span class="p">,</span> <span class="s1">&#39;ecila123&#39;</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">auth</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">base64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
<span class="go">b&#39;alice:ecila123&#39;</span>
</code></pre></div>

<p>If you need finer-grained control on the merging of client-level and request-level parameters, see <a href="#request-instances">Request instances</a>.</p>
<h3 id="other-client-only-configuration-options">Other Client-only configuration options</h3>
<p>Additionally, <code>Client</code> accepts some configuration options that aren't available at the request level.</p>
<p>For example, <code>base_url</code> allows you to prepend an URL to all outgoing requests:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;http://httpbin.org&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/headers&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
<span class="go">URL(&#39;http://httpbin.org/headers&#39;)</span>
</code></pre></div>

<p>For a list of all available client parameters, see the <a href="../api/#client"><code>Client</code></a> API reference.</p>
<hr />
<h2 id="character-set-encodings-and-auto-detection">Character set encodings and auto-detection</h2>
<p>When accessing <code>response.text</code>, we need to decode the response bytes into a unicode text representation.</p>
<p>By default <code>httpx</code> will use <code>"charset"</code> information included in the response <code>Content-Type</code> header to determine how the response bytes should be decoded into text.</p>
<p>In cases where no charset information is included on the response, the default behaviour is to assume "utf-8" encoding, which is by far the most widely used text encoding on the internet.</p>
<h3 id="using-the-default-encoding">Using the default encoding</h3>
<p>To understand this better let's start by looking at the default behaviour for text decoding...</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>
<span class="c1"># Instantiate a client with the default configuration.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="c1"># Using the client...</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>  <span class="c1"># This will either print the charset given in</span>
                          <span class="c1"># the Content-Type charset, or else &quot;utf-8&quot;.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># The text will either be decoded with the Content-Type</span>
                      <span class="c1"># charset, or using &quot;utf-8&quot;.</span>
</code></pre></div>

<p>This is normally absolutely fine. Most servers will respond with a properly formatted Content-Type header, including a charset encoding. And in most cases where no charset encoding is included, UTF-8 is very likely to be used, since it is so widely adopted.</p>
<h3 id="using-an-explicit-encoding">Using an explicit encoding</h3>
<p>In some cases we might be making requests to a site where no character set information is being set explicitly by the server, but we know what the encoding is. In this case it's best to set the default encoding explicitly on the client.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>
<span class="c1"># Instantiate a client with a Japanese character set as the default encoding.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">default_encoding</span><span class="o">=</span><span class="s2">&quot;shift-jis&quot;</span><span class="p">)</span>
<span class="c1"># Using the client...</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>  <span class="c1"># This will either print the charset given in</span>
                          <span class="c1"># the Content-Type charset, or else &quot;shift-jis&quot;.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># The text will either be decoded with the Content-Type</span>
                      <span class="c1"># charset, or using &quot;shift-jis&quot;.</span>
</code></pre></div>

<h3 id="using-character-set-auto-detection">Using character set auto-detection</h3>
<p>In cases where the server is not reliably including character set information, and where we don't know what encoding is being used, we can enable auto-detection to make a best-guess attempt when decoding from bytes to text.</p>
<p>To use auto-detection you need to set the <code>default_encoding</code> argument to a callable instead of a string. This callable should be a function which takes the input bytes as an argument and returns the character set to use for decoding those bytes to text.</p>
<p>There are two widely used Python packages which both handle this functionality:</p>
<ul>
<li><a href="https://chardet.readthedocs.io/"><code>chardet</code></a> - This is a well established package, and is a port of <a href="https://www-archive.mozilla.org/projects/intl/chardet.html">the auto-detection code in Mozilla</a>.</li>
<li><a href="https://charset-normalizer.readthedocs.io/"><code>charset-normalizer</code></a> - A newer package, motivated by <code>chardet</code>, with a different approach.</li>
</ul>
<p>Let's take a look at installing autodetection using one of these packages...</p>
<p><code>shell
$ pip install httpx
$ pip install chardet</code></p>
<p>Once <code>chardet</code> is installed, we can configure a client to use character-set autodetection.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">chardet</span>

<span class="k">def</span> <span class="nf">autodetect</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">)</span>

<span class="c1"># Using a client with character-set autodetection enabled.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">default_encoding</span><span class="o">=</span><span class="n">autodetect</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>  <span class="c1"># This will either print the charset given in</span>
                          <span class="c1"># the Content-Type charset, or else the auto-detected</span>
                          <span class="c1"># character set.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="calling-into-python-web-apps">Calling into Python Web Apps</h2>
<p>You can configure an <code>httpx</code> client to call directly into a Python web application using the WSGI protocol.</p>
<p>This is particularly useful for two main use-cases:</p>
<ul>
<li>Using <code>httpx</code> as a client inside test cases.</li>
<li>Mocking out external services during tests or in dev/staging environments.</li>
</ul>
<p>Here's an example of integrating against a Flask application:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">import</span> <span class="nn">httpx</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello World!&quot;</span>

<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;http://testserver&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Hello World!&quot;</span>
</code></pre></div>

<p>For some more complex cases you might need to customize the WSGI transport. This allows you to:</p>
<ul>
<li>Inspect 500 error responses rather than raise exceptions by setting <code>raise_app_exceptions=False</code>.</li>
<li>Mount the WSGI application at a subpath by setting <code>script_name</code> (WSGI).</li>
<li>Use a given client address for requests by setting <code>remote_addr</code> (WSGI).</li>
</ul>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Instantiate a client that makes WSGI requests with a client IP of &quot;1.2.3.4&quot;.</span>
<span class="n">transport</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">WSGITransport</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span> <span class="n">remote_addr</span><span class="o">=</span><span class="s2">&quot;1.2.3.4&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;http://testserver&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<h2 id="request-instances">Request instances</h2>
<p>For maximum control on what gets sent over the wire, HTTPX supports building explicit <a href="../api/#request"><code>Request</code></a> instances:</p>
<div class="highlight"><pre><span></span><code><span class="n">request</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://example.com&quot;</span><span class="p">)</span>
</code></pre></div>

<p>To dispatch a <code>Request</code> instance across to the network, create a <a href="#client-instances"><code>Client</code> instance</a> and use <code>.send()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="o">...</span>
</code></pre></div>

<p>If you need to mix client-level and request-level options in a way that is not supported by the default <a href="#merging-of-parameters">Merging of parameters</a>, you can use <code>.build_request()</code> and then make arbitrary modifications to the <code>Request</code> instance. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Api-Key&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="s2">&quot;X-Client-ID&quot;</span><span class="p">:</span> <span class="s2">&quot;ABC123&quot;</span><span class="p">}</span>

<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">build_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://api.example.com&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Client-ID&quot;</span><span class="p">])</span>  <span class="c1"># &quot;ABC123&quot;</span>

    <span class="c1"># Don&#39;t send the API key for this particular request.</span>
    <span class="k">del</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Api-Key&quot;</span><span class="p">]</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="o">...</span>
</code></pre></div>

<h2 id="event-hooks">Event Hooks</h2>
<p>HTTPX allows you to register "event hooks" with the client, that are called
every time a particular type of event takes place.</p>
<p>There are currently two event hooks:</p>
<ul>
<li><code>request</code> - Called after a request is fully prepared, but before it is sent to the network. Passed the <code>request</code> instance.</li>
<li><code>response</code> - Called after the response has been fetched from the network, but before it is returned to the caller. Passed the <code>response</code> instance.</li>
</ul>
<p>These allow you to install client-wide functionality such as logging, monitoring or tracing.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request event hook: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> - Waiting for response&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response event hook: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> - Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">log_request</span><span class="p">],</span> <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">log_response</span><span class="p">]})</span>
</code></pre></div>

<p>You can also use these hooks to install response processing code, such as this
example, which creates a client instance that always raises <code>httpx.HTTPStatusError</code>
on 4xx and 5xx responses.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">raise_on_4xx_5xx</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">raise_on_4xx_5xx</span><span class="p">]})</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Response event hooks are called before determining if the response body
should be read or not.</p>
<p>If you need access to the response body inside an event hook, you'll
need to call <code>response.read()</code>, or for AsyncClients, <code>response.aread()</code>.</p>
</div>
<p>The hooks are also allowed to modify <code>request</code> and <code>response</code> objects.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_timestamp</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-request-timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">event_hooks</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">add_timestamp</span><span class="p">]})</span>
</code></pre></div>

<p>Event hooks must always be set as a <strong>list of callables</strong>, and you may register
multiple event hooks for each type of event.</p>
<p>As well as being able to set event hooks on instantiating the client, there
is also an <code>.event_hooks</code> property, that allows you to inspect and modify
the installed hooks.</p>
<div class="highlight"><pre><span></span><code><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">event_hooks</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">log_request</span><span class="p">]</span>
<span class="n">client</span><span class="o">.</span><span class="n">event_hooks</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">log_response</span><span class="p">,</span> <span class="n">raise_on_4xx_5xx</span><span class="p">]</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using HTTPX's async support, then you need to be aware that
hooks registered with <code>httpx.AsyncClient</code> MUST be async functions,
rather than plain functions.</p>
</div>
<h2 id="monitoring-download-progress">Monitoring download progress</h2>
<p>If you need to monitor download progress of large responses, you can use response streaming and inspect the <code>response.num_bytes_downloaded</code> property.</p>
<p>This interface is required for properly determining download progress, because the total number of bytes returned by <code>response.content</code> or <code>response.iter_content()</code> will not always correspond with the raw content length of the response if HTTP response compression is being used.</p>
<p>For example, showing a progress bar using the <a href="https://github.com/tqdm/tqdm"><code>tqdm</code></a> library while a response is being downloaded could be done like this</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">download_file</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://speed.hetzner.de/100MB.bin&quot;</span>
    <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">])</span>

        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span> <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unit_divisor</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">num_bytes_downloaded</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">num_bytes_downloaded</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_bytes</span><span class="p">():</span>
                <span class="n">download_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">num_bytes_downloaded</span> <span class="o">-</span> <span class="n">num_bytes_downloaded</span><span class="p">)</span>
                <span class="n">num_bytes_downloaded</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">num_bytes_downloaded</span>
</code></pre></div>

<p><img alt="tqdm progress bar" src="../img/tqdm-progress.gif" /></p>
<p>Or an alternate example, this time using the <a href="https://github.com/willmcgugan/rich"><code>rich</code></a> library</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">rich.progress</span>

<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">download_file</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://speed.hetzner.de/100MB.bin&quot;</span>
    <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">])</span>

        <span class="k">with</span> <span class="n">rich</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">Progress</span><span class="p">(</span>
            <span class="s2">&quot;[progress.percentage]</span><span class="si">{task.percentage:&gt;3.0f}</span><span class="s2">%&quot;</span><span class="p">,</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">BarColumn</span><span class="p">(</span><span class="n">bar_width</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">DownloadColumn</span><span class="p">(),</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">TransferSpeedColumn</span><span class="p">(),</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">download_task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Download&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_bytes</span><span class="p">():</span>
                <span class="n">download_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">download_task</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">num_bytes_downloaded</span><span class="p">)</span>
</code></pre></div>

<p><img alt="rich progress bar" src="../img/rich-progress.gif" /></p>
<h2 id="netrc-support">.netrc Support</h2>
<p>HTTPX can be configured to use <a href="https://everything.curl.dev/usingcurl/netrc">a <code>.netrc</code> config file</a> for authentication.</p>
<p>The <code>.netrc</code> config file allows authentication credentials to be associated with specified hosts. When a request is made to a host that is found in the netrc file, the username and password will be included using HTTP basic auth.</p>
<p>Example <code>.netrc</code> file:</p>
<div class="highlight"><pre><span></span><code>machine example.org
login example-username
password example-password

machine python-httpx.org
login other-username
password other-password
</code></pre></div>

<p>Some examples of configuring <code>.netrc</code> authentication with <code>httpx</code>.</p>
<p>Use the default <code>.netrc</code> file in the users home directory:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">auth</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">NetRCAuth</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
</code></pre></div>

<p>Use an explicit path to a <code>.netrc</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">auth</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">NetRCAuth</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;/path/to/.netrc&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
</code></pre></div>

<p>Use the <code>NETRC</code> environment variable to configure a path to the <code>.netrc</code> file,
or fallback to the default.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">auth</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">NetRCAuth</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NETRC&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
</code></pre></div>

<p>The <code>NetRCAuth()</code> class uses <a href="https://docs.python.org/3/library/netrc.html">the <code>netrc.netrc()</code> function from the Python standard library</a>. See the documentation there for more details on exceptions that may be raised if the netrc file is not found, or cannot be parsed.</p>
<h2 id="http-proxying">HTTP Proxying</h2>
<p>HTTPX supports setting up <a href="https://en.wikipedia.org/wiki/Proxy_server#Web_proxy_servers">HTTP proxies</a> via the <code>proxies</code> parameter to be passed on client initialization or top-level API functions like <code>httpx.get(..., proxies=...)</code>.</p>
<div align="center">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Open_proxy_h2g2bob.svg/480px-Open_proxy_h2g2bob.svg.png"/>
    <figcaption><em>Diagram of how a proxy works (source: Wikipedia). The left hand side "Internet" blob may be your HTTPX client requesting <code>example.com</code> through a proxy.</em></figcaption>
</div>

<h3 id="example">Example</h3>
<p>To route all traffic (HTTP and HTTPS) to a proxy located at <code>http://localhost:8030</code>, pass the proxy URL to the client...</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<p>For more advanced use cases, pass a proxies <code>dict</code>. For example, to route HTTP and HTTPS requests to 2 different proxies, respectively located at <code>http://localhost:8030</code>, and <code>http://localhost:8031</code>, pass a <code>dict</code> of proxy URLs:</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;http://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8031&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>

<p>For detailed information about proxy routing, see the <a href="#routing">Routing</a> section.</p>
<div class="admonition tip">
<p class="admonition-title">Gotcha</p>
<p>In most cases, the proxy URL for the <code>https://</code> key <em>should</em> use the <code>http://</code> scheme (that's not a typo!).</p>
<p>This is because HTTP proxying requires initiating a connection with the proxy server. While it's possible that your proxy supports doing it via HTTPS, most proxies only support doing it via HTTP.</p>
<p>For more information, see <a href="#forward-vs-tunnel">FORWARD vs TUNNEL</a>.</p>
</div>
<h3 id="authentication">Authentication</h3>
<p>Proxy credentials can be passed as the <code>userinfo</code> section of the proxy URL. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;http://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://username:password@localhost:8030&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="routing">Routing</h3>
<p>HTTPX provides fine-grained controls for deciding which requests should go through a proxy, and which shouldn't. This process is known as proxy routing.</p>
<p>The <code>proxies</code> dictionary maps URL patterns ("proxy keys") to proxy URLs. HTTPX matches requested URLs against proxy keys to decide which proxy should be used, if any. Matching is done from most specific proxy keys (e.g. <code>https://&lt;domain&gt;:&lt;port&gt;</code>) to least specific ones (e.g. <code>https://</code>).</p>
<p>HTTPX supports routing proxies based on <strong>scheme</strong>, <strong>domain</strong>, <strong>port</strong>, or a combination of these.</p>
<h4 id="wildcard-routing">Wildcard routing</h4>
<p>Route everything through a proxy...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;all://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="scheme-routing">Scheme routing</h4>
<p>Route HTTP requests through one proxy, and HTTPS requests through another...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;http://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8031&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="domain-routing">Domain routing</h4>
<p>Proxy all requests on domain "example.com", let other requests pass through...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;all://example.com&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p>Proxy HTTP requests on domain "example.com", let HTTPS and other requests pass through...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;http://example.com&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p>Proxy all requests to "example.com" and its subdomains, let other requests pass through...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;all://*example.com&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p>Proxy all requests to strict subdomains of "example.com", let "example.com" and other requests pass through...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;all://*.example.com&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="port-routing">Port routing</h4>
<p>Proxy HTTPS requests on port 1234 to "example.com"...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;https://example.com:1234&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p>Proxy all requests on port 1234...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;all://*:1234&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="no-proxy-support">No-proxy support</h4>
<p>It is also possible to define requests that <em>shouldn't</em> be routed through proxies.</p>
<p>To do so, pass <code>None</code> as the proxy URL. For example...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Route requests through a proxy by default...</span>
    <span class="s2">&quot;all://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8031&quot;</span><span class="p">,</span>
    <span class="c1"># Except those for &quot;example.com&quot;.</span>
    <span class="s2">&quot;all://example.com&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="complex-configuration-example">Complex configuration example</h4>
<p>You can combine the routing features outlined above to build complex proxy routing configurations. For example...</p>
<div class="highlight"><pre><span></span><code><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Route all traffic through a proxy by default...</span>
    <span class="s2">&quot;all://&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8030&quot;</span><span class="p">,</span>
    <span class="c1"># But don&#39;t use proxies for HTTPS requests to &quot;domain.io&quot;...</span>
    <span class="s2">&quot;https://domain.io&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="c1"># And use another proxy for requests to &quot;example.com&quot; and its subdomains...</span>
    <span class="s2">&quot;all://*example.com&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8031&quot;</span><span class="p">,</span>
    <span class="c1"># And yet another proxy if HTTP is used,</span>
    <span class="c1"># and the &quot;internal&quot; subdomain on port 5550 is requested...</span>
    <span class="s2">&quot;http://internal.example.com:5550&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8032&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="environment-variables">Environment variables</h4>
<p>HTTP proxying can also be configured through environment variables, although with less fine-grained control.</p>
<p>See documentation on <a href="../environment_variables/#http_proxy-https_proxy-all_proxy"><code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code>, <code>ALL_PROXY</code></a> for more information.</p>
<h3 id="proxy-mechanisms">Proxy mechanisms</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section describes <strong>advanced</strong> proxy concepts and functionality.</p>
</div>
<h4 id="forward-vs-tunnel">FORWARD vs TUNNEL</h4>
<p>In general, the flow for making an HTTP request through a proxy is as follows:</p>
<ol>
<li>The client connects to the proxy (initial connection request).</li>
<li>The proxy transfers data to the server on your behalf.</li>
</ol>
<p>How exactly step 2/ is performed depends on which of two proxying mechanisms is used:</p>
<ul>
<li><strong>Forwarding</strong>: the proxy makes the request for you, and sends back the response it obtained from the server.</li>
<li><strong>Tunnelling</strong>: the proxy establishes a TCP connection to the server on your behalf, and the client reuses this connection to send the request and receive the response. This is known as an <a href="https://en.wikipedia.org/wiki/HTTP_tunnel">HTTP Tunnel</a>. This mechanism is how you can access websites that use HTTPS from an HTTP proxy (the client "upgrades" the connection to HTTPS by performing the TLS handshake with the server over the TCP connection provided by the proxy).</li>
</ul>
<h3 id="troubleshooting-proxies">Troubleshooting proxies</h3>
<p>If you encounter issues when setting up proxies, please refer to our <a href="../troubleshooting/#proxies">Troubleshooting guide</a>.</p>
<h2 id="socks">SOCKS</h2>
<p>In addition to HTTP proxies, <code>httpcore</code> also supports proxies using the SOCKS protocol.
This is an optional feature that requires an additional third-party library be installed before use.</p>
<p>You can install SOCKS support using <code>pip</code>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>httpx<span class="o">[</span>socks<span class="o">]</span>
</code></pre></div>

<p>You can now configure a client to make requests via a proxy using the SOCKS protocol:</p>
<div class="highlight"><pre><span></span><code><span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="s1">&#39;socks5://user:pass@host:port&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="timeout-configuration">Timeout Configuration</h2>
<p>HTTPX is careful to enforce timeouts everywhere by default.</p>
<p>The default behavior is to raise a <code>TimeoutException</code> after 5 seconds of
network inactivity.</p>
<h3 id="setting-and-disabling-timeouts">Setting and disabling timeouts</h3>
<p>You can set timeouts for an individual request:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Using the top-level API:</span>
<span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/api/v1/example&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># Using a client instance:</span>
<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://example.com/api/v1/example&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</code></pre></div>

<p>Or disable timeouts for an individual request:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Using the top-level API:</span>
<span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/api/v1/example&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Using a client instance:</span>
<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://example.com/api/v1/example&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

<h3 id="setting-a-default-timeout-on-a-client">Setting a default timeout on a client</h3>
<p>You can set a timeout on a client instance, which results in the given
<code>timeout</code> being used as the default for requests made with this client:</p>
<div class="highlight"><pre><span></span><code><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>              <span class="c1"># Use a default 5s timeout everywhere.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>  <span class="c1"># Use a default 10s timeout everywhere.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Disable all timeouts by default.</span>
</code></pre></div>

<h3 id="fine-tuning-the-configuration">Fine tuning the configuration</h3>
<p>HTTPX also allows you to specify the timeout behavior in more fine grained detail.</p>
<p>There are four different types of timeouts that may occur. These are <strong>connect</strong>,
<strong>read</strong>, <strong>write</strong>, and <strong>pool</strong> timeouts.</p>
<ul>
<li>The <strong>connect</strong> timeout specifies the maximum amount of time to wait until
a socket connection to the requested host is established. If HTTPX is unable to connect
within this time frame, a <code>ConnectTimeout</code> exception is raised.</li>
<li>The <strong>read</strong> timeout specifies the maximum duration to wait for a chunk of
data to be received (for example, a chunk of the response body). If HTTPX is
unable to receive data within this time frame, a <code>ReadTimeout</code> exception is raised.</li>
<li>The <strong>write</strong> timeout specifies the maximum duration to wait for a chunk of
data to be sent (for example, a chunk of the request body). If HTTPX is unable
to send data within this time frame, a <code>WriteTimeout</code> exception is raised.</li>
<li>The <strong>pool</strong> timeout specifies the maximum duration to wait for acquiring
a connection from the connection pool. If HTTPX is unable to acquire a connection
within this time frame, a <code>PoolTimeout</code> exception is raised. A related
configuration here is the maximum number of allowable connections in the
connection pool, which is configured by the <code>limits</code> argument.</li>
</ul>
<p>You can configure the timeout behavior for any of these values...</p>
<div class="highlight"><pre><span></span><code><span class="c1"># A client with a 60s timeout for connecting, and a 10s timeout elsewhere.</span>
<span class="n">timeout</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="pool-limit-configuration">Pool limit configuration</h2>
<p>You can control the connection pool size using the <code>limits</code> keyword
argument on the client. It takes instances of <code>httpx.Limits</code> which define:</p>
<ul>
<li><code>max_keepalive_connections</code>, number of allowable keep-alive connections, or <code>None</code> to always
allow. (Defaults 20)</li>
<li><code>max_connections</code>, maximum number of allowable connections, or <code>None</code> for no limits.
(Default 100)</li>
<li><code>keepalive_expiry</code>, time limit on idle keep-alive connections in seconds, or <code>None</code> for no limits. (Default 5)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">limits</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Limits</span><span class="p">(</span><span class="n">max_keepalive_connections</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_connections</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>
</code></pre></div>

<h2 id="multipart-file-encoding">Multipart file encoding</h2>
<p>As mentioned in the <a href="../quickstart/#sending-multipart-file-uploads">quickstart</a>
multipart file encoding is available by passing a dictionary with the
name of the payloads as keys and either tuple of elements or a file-like object or a string as values.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upload-file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">),</span> <span class="s1">&#39;application/vnd.ms-excel&#39;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/post&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">  ...</span>
<span class="go">  &quot;files&quot;: {</span>
<span class="go">    &quot;upload-file&quot;: &quot;&lt;... binary content ...&gt;&quot;</span>
<span class="go">  },</span>
<span class="go">  ...</span>
<span class="go">}</span>
</code></pre></div>

<p>More specifically, if a tuple is used as a value, it must have between 2 and 3 elements:</p>
<ul>
<li>The first element is an optional file name which can be set to <code>None</code>.</li>
<li>The second element may be a file-like object or a string which will be automatically
encoded in UTF-8.</li>
<li>An optional third element can be used to specify the
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_Types">MIME type</a>
of the file being uploaded. If not specified HTTPX will attempt to guess the MIME type based
on the file name, with unknown file extensions defaulting to "application/octet-stream".
If the file name is explicitly set to <code>None</code> then HTTPX will not include a content-type
MIME header field.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upload-file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;text content&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/post&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">  ...</span>
<span class="go">  &quot;files&quot;: {},</span>
<span class="go">  &quot;form&quot;: {</span>
<span class="go">    &quot;upload-file&quot;: &quot;text-content&quot;</span>
<span class="go">  },</span>
<span class="go">  ...</span>
<span class="go">}</span>
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is safe to upload large files this way. File uploads are streaming by default, meaning that only one chunk will be loaded into memory at a time.</p>
</div>
<p>Non-file data fields can be included in the multipart form using by passing them to <code>data=...</code>.</p>
<p>You can also send multiple files in one go with a multiple file field form.
To do that, pass a list of <code>(field, &lt;file&gt;)</code> items instead of a dictionary, allowing you to pass multiple items with the same <code>field</code>.
For instance this request sends 2 files, <code>foo.png</code> and <code>bar.png</code> in one request on the <code>images</code> form field:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;foo.png&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;foo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">),</span> <span class="s1">&#39;image/png&#39;</span><span class="p">)),</span>
<span class="go">                      (&#39;images&#39;, (&#39;bar.png&#39;, open(&#39;bar.png&#39;, &#39;rb&#39;), &#39;image/png&#39;))]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/post&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</code></pre></div>

<h2 id="customizing-authentication">Customizing authentication</h2>
<p>When issuing requests or instantiating a client, the <code>auth</code> argument can be used to pass an authentication scheme to use. The <code>auth</code> argument may be one of the following...</p>
<ul>
<li>A two-tuple of <code>username</code>/<code>password</code>, to be used with basic authentication.</li>
<li>An instance of <code>httpx.BasicAuth()</code>, <code>httpx.DigestAuth()</code>, or <code>httpx.NetRCAuth()</code>.</li>
<li>A callable, accepting a request and returning an authenticated request instance.</li>
<li>An instance of subclasses of <code>httpx.Auth</code>.</li>
</ul>
<p>The most involved of these is the last, which allows you to create authentication flows involving one or more requests. A subclass of <code>httpx.Auth</code> should implement <code>def auth_flow(request)</code>, and yield any requests that need to be made...</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomAuth</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">Auth</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>

    <span class="k">def</span> <span class="nf">auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Send the request, with a custom `X-Authentication` header.</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Authentication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span>
        <span class="k">yield</span> <span class="n">request</span>
</code></pre></div>

<p>If the auth flow requires more than one request, you can issue multiple yields, and obtain the response in each case...</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomAuth</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">Auth</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>

    <span class="k">def</span> <span class="nf">auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
      <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">request</span>
      <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
          <span class="c1"># If the server issues a 401 response then resend the request,</span>
          <span class="c1"># with a custom `X-Authentication` header.</span>
          <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Authentication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span>
          <span class="k">yield</span> <span class="n">request</span>
</code></pre></div>

<p>Custom authentication classes are designed to not perform any I/O, so that they may be used with both sync and async client instances. If you are implementing an authentication scheme that requires the request body, then you need to indicate this on the class using a <code>requires_request_body</code> property.</p>
<p>You will then be able to access <code>request.content</code> inside the <code>.auth_flow()</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomAuth</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">Auth</span><span class="p">):</span>
    <span class="n">requires_request_body</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>

    <span class="k">def</span> <span class="nf">auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
      <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">request</span>
      <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
          <span class="c1"># If the server issues a 401 response then resend the request,</span>
          <span class="c1"># with a custom `X-Authentication` header.</span>
          <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Authentication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sign_request</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
          <span class="k">yield</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">sign_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># Create a request signature, based on `request.method`, `request.url`,</span>
        <span class="c1"># `request.headers`, and `request.content`.</span>
        <span class="o">...</span>
</code></pre></div>

<p>Similarly, if you are implementing a scheme that requires access to the response body, then use the <code>requires_response_body</code> property.   You will then be able to access response body properties and methods such as <code>response.content</code>, <code>response.text</code>, <code>response.json()</code>, etc.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomAuth</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">Auth</span><span class="p">):</span>
    <span class="n">requires_response_body</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">,</span> <span class="n">refresh_url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">access_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">refresh_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_url</span> <span class="o">=</span> <span class="n">refresh_url</span>

    <span class="k">def</span> <span class="nf">auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Authentication&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">request</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="c1"># If the server issues a 401 response, then issue a request to</span>
            <span class="c1"># refresh tokens, and resend the request.</span>
            <span class="n">refresh_response</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_refresh_request</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_tokens</span><span class="p">(</span><span class="n">refresh_response</span><span class="p">)</span>

            <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Authentication&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span>
            <span class="k">yield</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">build_refresh_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Return an `httpx.Request` for refreshing tokens.</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">update_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># Update the `.access_token` and `.refresh_token` tokens</span>
        <span class="c1"># based on a refresh response.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="o">...</span>
</code></pre></div>

<p>If you <em>do</em> need to perform I/O other than HTTP requests, such as accessing a disk-based cache, or you need to use concurrency primitives, such as locks, then you should override <code>.sync_auth_flow()</code> and <code>.async_auth_flow()</code> (instead of <code>.auth_flow()</code>). The former will be used by <code>httpx.Client</code>, while the latter will be used by <code>httpx.AsyncClient</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">httpx</span>


<span class="k">class</span> <span class="nc">MyCustomAuth</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">Auth</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_async_lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">sync_get_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sync_lock</span><span class="p">:</span>
            <span class="o">...</span>

    <span class="k">def</span> <span class="nf">sync_auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_get_token</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">yield</span> <span class="n">request</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_get_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_async_lock</span><span class="p">:</span>
            <span class="o">...</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">token</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_get_token</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">yield</span> <span class="n">request</span>
</code></pre></div>

<p>If you only want to support one of the two methods, then you should still override it, but raise an explicit <code>RuntimeError</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">sync_only_library</span>


<span class="k">class</span> <span class="nc">MyCustomAuth</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">Auth</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">sync_auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">sync_only_library</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">yield</span> <span class="n">request</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_auth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot use a sync authentication class with httpx.AsyncClient&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="ssl-certificates">SSL certificates</h2>
<p>When making a request over HTTPS, HTTPX needs to verify the identity of the requested host. To do this, it uses a bundle of SSL certificates (a.k.a. CA bundle) delivered by a trusted certificate authority (CA).</p>
<h3 id="changing-the-verification-defaults">Changing the verification defaults</h3>
<p>By default, HTTPX uses the CA bundle provided by <a href="https://pypi.org/project/certifi/">Certifi</a>. This is what you want in most cases, even though some advanced situations may require you to use a different set of certificates.</p>
<p>If you'd like to use a custom CA bundle, you can use the <code>verify</code> parameter.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.org&quot;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="s2">&quot;path/to/client.pem&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Alternatively, you can pass a standard library <code>ssl.SSLContext</code>.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ssl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="n">cafile</span><span class="o">=</span><span class="s2">&quot;/tmp/client.pem&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.org&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<span class="go">&lt;Response [200 OK]&gt;</span>
</code></pre></div>

<p>We also include a helper function for creating properly configured <code>SSLContext</code> instances.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">create_ssl_context</span><span class="p">()</span>
</code></pre></div>

<p>The <code>create_ssl_context</code> function accepts the same set of SSL configuration arguments
(<code>trust_env</code>, <code>verify</code>, <code>cert</code> and <code>http2</code> arguments)
as <code>httpx.Client</code> or <code>httpx.AsyncClient</code></p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">create_ssl_context</span><span class="p">(</span><span class="n">verify</span><span class="o">=</span><span class="s2">&quot;/tmp/client.pem&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.org&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<span class="go">&lt;Response [200 OK]&gt;</span>
</code></pre></div>

<p>Or you can also disable the SSL verification entirely, which is <em>not</em> recommended.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.org&quot;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<h3 id="ssl-configuration-on-client-instances">SSL configuration on client instances</h3>
<p>If you're using a <code>Client()</code> instance, then you should pass any SSL settings when instantiating the client.</p>
<div class="highlight"><pre><span></span><code><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<p>The <code>client.get(...)</code> method and other request methods <em>do not</em> support changing the SSL settings on a per-request basis. If you need different SSL settings in different cases you should use more that one client instance, with different settings on each. Each client will then be using an isolated connection pool with a specific fixed SSL configuration on all connections within that pool.</p>
<h3 id="client-side-certificates">Client Side Certificates</h3>
<p>You can also specify a local cert to use as a client-side certificate, either a path to an SSL certificate file, or two-tuple of (certificate file, key file), or a three-tuple of (certificate file, key file, password)</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.org&quot;</span><span class="p">,</span> <span class="n">cert</span><span class="o">=</span><span class="s2">&quot;path/to/client.pem&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Alternatively,</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cert</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;path/to/client.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;path/to/client.key&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.org&quot;</span><span class="p">,</span> <span class="n">cert</span><span class="o">=</span><span class="n">cert</span><span class="p">)</span>
<span class="go">&lt;Response [200 OK]&gt;</span>
</code></pre></div>

<p>or</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cert</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;path/to/client.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;path/to/client.key&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.org&quot;</span><span class="p">,</span> <span class="n">cert</span><span class="o">=</span><span class="n">cert</span><span class="p">)</span>
<span class="go">&lt;Response [200 OK]&gt;</span>
</code></pre></div>

<h3 id="making-https-requests-to-a-local-server">Making HTTPS requests to a local server</h3>
<p>When making requests to local servers, such as a development server running on <code>localhost</code>, you will typically be using unencrypted HTTP connections.</p>
<p>If you do need to make HTTPS connections to a local server, for example to test an HTTPS-only service, you will need to create and use your own certificates. Here's one way to do it:</p>
<ol>
<li>Use <a href="https://github.com/python-trio/trustme">trustme</a> to generate a pair of server key/cert files, and a client cert file.</li>
<li>Pass the server key/cert files when starting your local server. (This depends on the particular web server you're using. For example, <a href="https://www.uvicorn.org">Uvicorn</a> provides the <code>--ssl-keyfile</code> and <code>--ssl-certfile</code> options.)</li>
<li>Tell HTTPX to use the certificates stored in <code>client.pem</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://localhost:8000&quot;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="s2">&quot;/tmp/client.pem&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span>
<span class="go">Response &lt;200 OK&gt;</span>
</code></pre></div>

<h2 id="custom-transports">Custom Transports</h2>
<p>HTTPX's <code>Client</code> also accepts a <code>transport</code> argument. This argument allows you
to provide a custom Transport object that will be used to perform the actual
sending of the requests.</p>
<h3 id="usage_1">Usage</h3>
<p>For some advanced configuration you might need to instantiate a transport
class directly, and pass it to the client instance. One example is the
<code>local_address</code> configuration which is only available via this low-level API.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transport</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPTransport</span><span class="p">(</span><span class="n">local_address</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">)</span>
</code></pre></div>

<p>Connection retries are also available via this interface. Requests will be retried the given number of times in case an <code>httpx.ConnectError</code> or an <code>httpx.ConnectTimeout</code> occurs, allowing smoother operation under flaky networks. If you need other forms of retry behaviors, such as handling read/write errors or reacting to <code>503 Service Unavailable</code>, consider general-purpose tools such as <a href="https://github.com/jd/tenacity">tenacity</a>.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transport</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPTransport</span><span class="p">(</span><span class="n">retries</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">)</span>
</code></pre></div>

<p>Similarly, instantiating a transport directly provides a <code>uds</code> option for
connecting via a Unix Domain Socket that is only available via this low-level API:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Connect to the Docker API via a Unix Socket.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transport</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPTransport</span><span class="p">(</span><span class="n">uds</span><span class="o">=</span><span class="s2">&quot;/var/run/docker.sock&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://docker/info&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="go">{&quot;ID&quot;: &quot;...&quot;, &quot;Containers&quot;: 4, &quot;Images&quot;: 74, ...}</span>
</code></pre></div>

<h3 id="urllib3-transport">urllib3 transport</h3>
<p>This <a href="https://gist.github.com/florimondmanca/d56764d78d748eb9f73165da388e546e">public gist</a> provides a transport that uses the excellent <a href="https://urllib3.readthedocs.io/en/latest/"><code>urllib3</code> library</a>, and can be used with the sync <code>Client</code>...</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">urllib3_transport</span> <span class="kn">import</span> <span class="n">URLLib3Transport</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">URLLib3Transport</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.org&quot;</span><span class="p">)</span>
<span class="go">&lt;Response [200 OK]&gt;</span>
</code></pre></div>

<h3 id="writing-custom-transports">Writing custom transports</h3>
<p>A transport instance must implement the low-level Transport API, which deals
with sending a single request, and returning a response. You should either
subclass <code>httpx.BaseTransport</code> to implement a transport to use with <code>Client</code>,
or subclass <code>httpx.AsyncBaseTransport</code> to implement a transport to
use with <code>AsyncClient</code>.</p>
<p>At the layer of the transport API we're using the familiar <code>Request</code> and
<code>Response</code> models.</p>
<p>See the <code>handle_request</code> and <code>handle_async_request</code> docstrings for more details
on the specifics of the Transport API.</p>
<p>A complete example of a custom transport implementation would be:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">httpx</span>


<span class="k">class</span> <span class="nc">HelloWorldTransport</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">BaseTransport</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mock transport that always returns a JSON &quot;Hello, world!&quot; response.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello, world!&quot;</span><span class="p">}</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">ByteStream</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="sa">b</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;application/json&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</code></pre></div>

<p>Which we can use in the same way:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">HelloWorldTransport</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://example.org/&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="go">{&quot;text&quot;: &quot;Hello, world!&quot;}</span>
</code></pre></div>

<h3 id="mock-transports">Mock transports</h3>
<p>During testing it can often be useful to be able to mock out a transport,
and return pre-determined responses, rather than making actual network requests.</p>
<p>The <code>httpx.MockTransport</code> class accepts a handler function, which can be used
to map requests onto pre-determined responses:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello, world!&quot;</span><span class="p">})</span>


<span class="c1"># Switch to a mock transport, if the TESTING environment variable is set.</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TESTING&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">:</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">MockTransport</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPTransport</span><span class="p">()</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">)</span>
</code></pre></div>

<p>For more advanced use-cases you might want to take a look at either <a href="https://lundberg.github.io/respx/">the third-party
mocking library, RESPX</a>, or the <a href="https://github.com/Colin-b/pytest_httpx">pytest-httpx library</a>.</p>
<h3 id="mounting-transports">Mounting transports</h3>
<p>You can also mount transports against given schemes or domains, to control
which transport an outgoing request should be routed via, with <a href="#routing">the same style
used for specifying proxy routing</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>

<span class="k">class</span> <span class="nc">HTTPSRedirectTransport</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">BaseTransport</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A transport that always redirects to HTTPS.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">extensions</span><span class="p">):</span>
        <span class="n">scheme</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;https://</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;https://</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">ByteStream</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="sa">b</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">location</span><span class="p">)]</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="mi">303</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">extensions</span>


<span class="c1"># A client where any `http` requests are always redirected to `https`</span>
<span class="n">mounts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;http://&#39;</span><span class="p">:</span> <span class="n">HTTPSRedirectTransport</span><span class="p">()}</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">mounts</span><span class="o">=</span><span class="n">mounts</span><span class="p">)</span>
</code></pre></div>

<p>A couple of other sketches of how you might take advantage of mounted transports...</p>
<p>Disabling HTTP/2 on a single given domain...</p>
<div class="highlight"><pre><span></span><code><span class="n">mounts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;all://&quot;</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPTransport</span><span class="p">(</span><span class="n">http2</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="s2">&quot;all://*example.org&quot;</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPTransport</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">mounts</span><span class="o">=</span><span class="n">mounts</span><span class="p">)</span>
</code></pre></div>

<p>Mocking requests to a given domain:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># All requests to &quot;example.org&quot; should be mocked out.</span>
<span class="c1"># Other requests occur as usual.</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello, World!&quot;</span><span class="p">})</span>

<span class="n">mounts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;all://example.org&quot;</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">MockTransport</span><span class="p">(</span><span class="n">handler</span><span class="p">)}</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">mounts</span><span class="o">=</span><span class="n">mounts</span><span class="p">)</span>
</code></pre></div>

<p>Adding support for custom schemes:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Support URLs like &quot;file:///Users/sylvia_green/websites/new_client/index.html&quot;</span>
<span class="n">mounts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file://&quot;</span><span class="p">:</span> <span class="n">FileSystemTransport</span><span class="p">()}</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">mounts</span><span class="o">=</span><span class="n">mounts</span><span class="p">)</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.407015b8.min.js"></script>
      
        <script src="../js/chat.js"></script>
      
        <script src="../js/sidecar-1.5.0.js"></script>
      
    
  </body>
</html>